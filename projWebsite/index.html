<!DOCTYPE HTML>
<!--
	Projection by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
	<head>
		<title>PocketHome</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/css/main.css" />

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

		<!-- Firebase -->
		<script src="https://www.gstatic.com/firebasejs/3.3.2/firebase.js"></script>

		<!-- canvasjs -->
		<script src="js/jquery.canvasjs.min.js"></script>

		<!-- Material Design fonts -->
		<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

		<!-- Bootstrap -->
		<link rel="stylesheet" href="assets/css/dashboard/bootstrap.min.css">
		<link rel="stylesheet" href="assets/css/dashboard/bootstrap-material-design.min.css">
		<link rel="stylesheet" href="assets/css/dashboard/ripples.min.css">
		<script src="assets/js/dashboard/bootstrap.min.js"></script>
		<script src="assets/js/dashboard/material.min.js"></script>
		<script src="assets/js/dashboard/ripples.min.js"></script>

		<!-- Animate.css -->
		<link rel="stylesheet" href="assets/css/dashboard/animate.min.css">

		<script>
		var chart, toOffline;
		var newItems = false;
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyAh3Tab-d36nEHeCu1v9AeaWtTiRfvSJEw",
			authDomain: "esp-data-logger.firebaseapp.com",
			databaseURL: "https://esp-data-logger.firebaseio.com",
			storageBucket: "esp-data-logger.appspot.com",
		};

		$(document).ready(function(e) {
			$.material.init()

			chart = new CanvasJS.Chart("chartContainer", {
				title: {
					text: "Temperature & Humidity"
				},
				axisX:{  
					valueFormatString: "HH:mm"
				},
				axisY: {
					valueFormatString: "0.0#"
				},
				toolTip: {
					shared: true,
					contentFormatter: function (e) {
						var content = CanvasJS.formatDate(e.entries[0].dataPoint.x, "HH:mm:ss") + "<br>";
						content += "<strong>Temperature</strong>: " + e.entries[0].dataPoint.y + " &deg;C<br>";
						content += "<strong>Humidity</strong>: " + e.entries[1].dataPoint.y + " %";
						return content;
					}
				},
				animationEnabled: true,
				data: [
					{
						type: "spline", //change it to line, area, column, pie, etc
						dataPoints: []
					},
					{
						type: "spline", //change it to line, area, column, pie, etc
						dataPoints: []
					}
				]
			});
			chart.render();	

			firebase.initializeApp(config);

			var logDHT = firebase.database().ref().child("logDHT");

			logDHT.on("child_added", function(sanp) {
				if (!newItems) return;
				var row = sanp.val();

				row.time = new Date(row.time);
				chart.options.data[0].dataPoints.push({x: row.time, y: row.temperature});
				chart.options.data[1].dataPoints.push({x: row.time, y: row.humidity});
				chart.render();

				$("#temperature > .content").html(row.temperature + " &deg;C");
				$("#humidity > .content").text(row.humidity + " %");

				$("#status").removeClass("danger").addClass("success");
				$("#status > .content").text("ONLINE");

				setTimeoffline();
			});

			var now = new Date();
			logDHT.orderByChild("time").startAt(now.getFullYear() + "-" + (now.getMonth() + 1) + "-" + now.getDate()).once("value", function(sanp) {
				console.log(sanp);
				newItems = true;
				var dataRows = sanp.val();
				var lastRows = 0;
				$.each(dataRows, function(index, row) {
					row.time = new Date(row.time);
					chart.options.data[0].dataPoints.push({x: row.time, y: row.temperature});
					chart.options.data[1].dataPoints.push({x: row.time, y: row.humidity});
					 lastRows = row;
				});
				chart.render();

				var Arow = lastRows;
				$("#temperature > .content").html(Arow.temperature + " &deg;C");
				$("#humidity > .content").text(Arow.humidity + " %");

				var now = new Date();
				Arow.time = new Date(Arow.time);
				if (Math.round(now) -  Math.round(Arow.time) < (2 * 60 * 1000)) {
					$("#status").removeClass("danger").addClass("success");
					$("#status > .content").text("ONLINE");
				} else {
					$("#status").removeClass("success").addClass("danger");
					$("#status > .content").text("OFFLINE");
				}

				setTimeoffline();
			});
		});

		var setTimeoffline = function() {
			if (typeof toOffline === "number") clearTimeout(toOffline);

			toOffline = setTimeout(function() {
				$("#status").removeClass("success").addClass("danger");
				$("#status > .content").text("OFFLINE");
			}, 2 * 60 * 1000);
		}
		</script>

		<style>
		.dialog {
			width: 100%;
			border-radius: 4px;
			margin-bottom: 20px;
			box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.12), 0 1px 6px 0 rgba(0, 0, 0, 0.12);
		}
		.dialog > .content {
			padding: 30px 0;
			border-radius: 6px 6px 0 0;
			font-size: 64px;
			color: rgba(255,255,255, 0.84);
			text-align: center;
		}
		.dialog.primary > .content{
			background: #00aa9a;
		}
		.dialog.success > .content {
			background: #59b75c;
		}
		.dialog.info > .content {
			background: #03a9f4;
		}
		.dialog.warning > .content {
			background: #ff5722;
		}

		.dialog.danger > .content {
			background: #f44336;
		}
		.dialog > .title {
			background: #FFF;
			border-radius: 0 0 6px 6px;
			font-size: 22px;
			color: rgba(0,0,0, 0.87);
			text-align: center;
			padding: 10px 0;
			/* box-shadow: 0px 10px 8px -10px rgba(0, 0, 0, 0.4) inset; */
			font-weight: bold;
		}
		.nav-tabs {
			margin-bottom: 20px;
		}
		</style>
	</head>
	<body>

		<!-- Header -->
			<header id="header">
				<div class="inner">
					<a href="index.html" class="logo"><strong>PocketHome</strong></a>
					<nav id="nav">
						<a href="index.html">Home</a>
						<a href="generic.html">Dashboard</a>
						<a href="login.html">Login</a>
					</nav>
					<a href="#navPanel" class="navPanelToggle"><span class="fa fa-bars"></span></a>
				</div>
			</header>

		<!-- Banner -->
			<section id="banner">
				<div class="inner">
					<header>
						<h1>Welcome to PocketHome</h1>
					</header>

					<div class="flex ">

						<div>
							<span class="icon fa-lightbulb-o"></span>
							<h3>Aliquam</h3>
							<p>Suspendisse amet ullamco</p>
						</div>

						<div>
							<span class="icon fa-warning"></span>
							<h3>Elementum</h3>
							<p>Class aptent taciti ad litora</p>
						</div>

						<div>
							<span class="icon fa-home"></span>
							<h3>Ultrices</h3>
							<p>Nulla vitae mauris non felis</p>
						</div>
					</div>

					<footer>
						<a href="#" class="button">Get Started</a>
					</footer>
				</div>
			</section>


		<!-- Three -->
			<section id="three" class="wrapper align-center">
				<div class="inner">
					<div class="flex flex-2">
						<article>
							<div class="image round">
								<img src="images/pic01.jpg" alt="Pic 01" />
							</div>
							<header>
								<h3>Lorem ipsum<br /> dolor amet nullam</h3>
							</header>
							<p>Morbi in sem quis dui placerat ornare. Pellentesquenisi<br />euismod in, pharetra a, ultricies in diam sed arcu. Cras<br />consequat  egestas augue vulputate.</p>
							<footer>
								<a href="#" class="button">Learn More</a>
							</footer>
						</article>
						<article>
							<div class="image round">
								<img src="images/pic02.jpg" alt="Pic 02" />
							</div>
							<header>
								<h3>Sed feugiat<br /> tempus adipicsing</h3>
							</header>
							<p>Pellentesque fermentum dolor. Aliquam quam lectus<br />facilisis auctor, ultrices ut, elementum vulputate, nunc<br /> blandit ellenste egestagus commodo.</p>
							<footer>
								<a href="#" class="button">Learn More</a>
							</footer>
						</article>
					</div>
				</div>
			</section>

		<!-- Footer -->
			<footer id="footer">
				<div class="inner">

					<h3>Get in touch</h3>

					<form action="#" method="post">

						<div class="field half first">
							<label for="name">Name</label>
							<input name="name" id="name" type="text" placeholder="Name">
						</div>
						<div class="field half">
							<label for="email">Email</label>
							<input name="email" id="email" type="email" placeholder="Email">
						</div>
						<div class="field">
							<label for="message">Message</label>
							<textarea name="message" id="message" rows="6" placeholder="Message"></textarea>
						</div>
						<ul class="actions">
							<li><input value="Send Message" class="button alt" type="submit"></li>
						</ul>
					</form>

					<div class="copyright">
						&copy; Untitled. Design: <a href="https://templated.co">TEMPLATED</a>. Images: <a href="https://unsplash.com">Unsplash</a>.
					</div>

				</div>
			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>